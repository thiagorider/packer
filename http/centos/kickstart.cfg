# centos6.7-x86_64
# Command	: linux ks=http://<local_webserver>/centos6.7/kickstart.cfg ksdevice=eth1



# Install OS instead of upgrade
install

# Installation logging level
logging --level=debug

# Use graphical install
graphical

# Use HTTP installation media
url --url http://<local_web_server>

# System keyboard
keyboard br-abnt2

# System language
lang en_US.UTF-8

# Network information
network --onboot on --device eth0 --bootproto dhcp --noipv6
#network --onboot on --device eth1 --bootproto dhcp --noipv6

# Root password
rootpw  --iscrypted <md5_hash>

# CIS 4.7
# Firewall configuration 
firewall --service=ssh

# CIS 6.3.1
# System authorization information
authconfig --disablewins --disableshadow --disablewinbindauth --disablewinbind --disablekrb5 --disablefingerprint --disablesmartcard --disableldapstarttls --disablesssd --disableshadow --enablemd5 --enableldap --enableldapauth --enableforcelegacy --ldapserver=ldap://10.40.2.20/ --ldapbasedn=dc=example-sa,dc=com --updateall

# CIS 1.4.2-1.4.3 (targeted is enabled by default w/enforcing)
# SELinux configuration
selinux --enforcing

# System timezone
timezone --utc America/Sao_Paulo

# Enumerate all required to be enabled services
# services --enabled network,sshd

# Run the Setup Agent on first boot
firstboot --disable

# Skip entering installation number
key --skip

# X Window System configuration information
xconfig  --defaultdesktop=KDE --depth=24 --resolution=1920x1200 --startxonboot

# Clear the Master Boot Record
zerombr

# Partition clearing information
clearpart --all --initlabel --drives=sda,sdb


#################################
# Disk partitioning             #
#################################

part /boot/efi --fstype=efi --size=250 --ondisk sdb
part /boot --fstype ext4 --size=500 --ondisk sdb
part swap --size=16384 --ondisk sda

part pv.000001 --grow --size=39936 --ondisk sda             # FIRST DEVICE
part pv.000002 --grow --size=55296 --ondisk sdb             # SECOND DEVICE


volgroup vg_BIG pv.000001
volgroup vg_SSD pv.000002


### FIRST Logical Volumes ###

logvol / --vgname vg_FIRST --name root --fstype=ext4 --size=25600

logvol /local --vgname vg_FIRST --name local --size=25600 --fsoptions="nodev" --grow

# LVM Snapshot future feature prevision
logvol /lvm_snapshot_FIRST --vgname vg_FIRST --name lvm_snapshot_FIRST --size=10240

# CIS 1.1.9-1.1.0
logvol /home --vgname vg_FIRST --name home --size=4096 --fsoptions="nodev" 


### SECOND Logical Volumes ###

logvol /local_SECOND --vgname vg_SECOND --name local_SECOND --size=25600 --fsoptions="nodev" --grow

# LVM Snapshot future feature prevision
logvol /lvm_snapshot_SECOND --vgname vg_SECOND --name lvm_snapshot_SECOND --size=20480

# CIS 1.1.1-1.1.4
logvol /tmp --vgname vg_SECOND --name tmp --size=4096 --fsoptions="nodev,nosuid,noexec" 

# CIS 1.1.5
logvol /var --vgname vg_SECOND --name var --size=2048

# CIS 1.1.7
logvol /var/log --vgname vg_SECOND --name log --size=4096

# CIS 1.1.8
logvol /var/log/audit --vgname vg_SECOND --name audit --size=4096

 

# CIS 1.4.1, 5.2.3
# System bootloader configuration
bootloader --location=mbr --driveorder=sdb,sda --append="selinux=1 audit=1" --md5pass=<md5_hash>
reboot



################################
# Package installation section #
################################
## If the group is selected for installation, the packages marked "mandatory" in the package list are always installed, 
## the packages marked "default" are installed if they are not specifically excluded elsewhere, and the packages marked 
## "optional" must be specifically included elsewhere even when the group is selected.

%packages

### CORE ###
## Group: Core
## Description: Smallest possible installation.
## Mandatory Packages: acl attr audit basesystem bash coreutils cpio cronie dhclient e2fsprogs filesystem glibc initscripts iproute iptables iptables-ipv6 iputils kbd ncurses openssh-server passwd policycoreutils procps redhat-support-tool rhnsd rootfiles rpm rsyslog selinux-policy-targeted setup shadow-utils subscription-manager sudo util-linux-ng vim-minimal yum yum-rhn-plugin
## Default Packages: aic94xx-firmware atmel-firmware b43-openfwwf bfa-firmware efibootmgr grub ipw2100-firmware ipw2200-firmware ivtv-firmware iwl100-firmware iwl1000-firmware iwl3945-firmware iwl4965-firmware iwl5000-firmware iwl5150-firmware iwl6000-firmware iwl6000g2a-firmware iwl6050-firmware kernel-firmware kexec-tools libertas-usb8388-firmware netxen-firmware postfix ql2100-firmware ql2200-firmware ql23xx-firmware ql2400-firmware ql2500-firmware rt61pci-firmware rt73usb-firmware xorg-x11-drv-ati-firmware zd1211-firmware
## Optional Packages: dracut-fips dracut-network libee-devel openssh-server-fips selinux-policy-doc

@core
yum-plugin-downloadonly

## Attended Security Controls: 
selinux-policy-targeted     # CIS 1.4.3
rsyslog                     # CIS 5.1.2




### BASE ###
## Group: Base
## Description: The basic installation of Red Hat Enterprise Linux.
## Mandatory Packages: alsa-utils at authconfig bc bind-utils crontabs cyrus-sasl-plain dbus ed file logrotate lsof man ntsysv parted pciutils psacct quota redhat-indexhtml setserial tmpwatch traceroute
## Default Packages: Red_Hat_Enterprise_Linux-Release_Notes-6-en-US abrt-addon-ccpp abrt-addon-kerneloops abrt-addon-python abrt-cli abrt-plugin-mailx abrt-plugin-sosreport acpid b43-fwcutter biosdevname blktrace bridge-utils bzip2 cpuspeed cryptsetup-luks dmraid dosfstools eject ethtool fprintd-pam gnupg2 hunspell hunspell-en irqbalance ledmon libaio lvm2 man-pages man-pages-overrides mdadm microcode_ctl mlocate mtr nano ntp ntpdate openssh-clients openssl-ibmca pam_passwdqc pcmciautils pinfo plymouth pm-utils prelink rdate rdma readahead redhat-access-insights redhat-support-tool rfkill rng-tools rsync scl-utils setuptool smartmontools sos strace sysstat system-config-firewall-tui system-config-network-tui systemtap-runtime tcpdump tcsh time unzip usbutils vconfig vim-enhanced virt-what wget which wireless-tools words xz yum-plugin-security yum-utils zip
## Optional Packages: PyPAM audispd-plugins brltty convmv cpupowerutils cryptsetup-reencrypt device-mapper-persistent-data dos2unix dumpet ecryptfs-utils edac-utils gdisk genisoimage gpm kabi-yum-plugins kernel-doc linuxptp logwatch mkbootdisk mtools ncurses-term nss_db oddjob openssh-clients-fips pax python-dmidecode python-volume_key rsyslog-gnutls rsyslog-gssapi rsyslog-relp servicelog sgpio sox squashfs-tools star subscription-manager-migration subscription-manager-migration-data tboot tunctl udftools unix2dos uuidd volume_key wodim x86info yum-plugin-aliases yum-plugin-changelog yum-plugin-downloadonly yum-plugin-protect-packages yum-plugin-tmprepo yum-plugin-verify yum-plugin-versionlock yum-presto zsh

@base
mtools
pax
python-dmidecode
oddjob
wodim
sgpio
device-mapper-persistent-data
genisoimage

## Attended Security Controls: 
ntp                         # CIS 3.6
pam_passwdqc                # CIS 6.3.3




### SYSTEM-ADMIN-TOOLS ###
## Group: System administration tools
## Description: Utilities useful in system administration.
## Optional Packages: conman crypto-utils dtach expect hardlink lshw lsscsi mc mgetty pexpect rdist rrdtool screen scrub symlinks tree vlock xdelta

@system-admin-tools
dtach
expect
lshw
mc
screen
tree
vlock




### GRAPHICAL-ADMIN-TOOLS ###
## Group: Graphical Administration Tools
## Description: Graphical system administration tools for managing many aspects of a system.
## Mandatory Packages: dbus
## Default Packages: authconfig-gtk gnome-disk-utility gnome-packagekit system-config-firewall system-config-kdump system-config-keyboard system-config-services system-config-users
## Optional Packages: audit-viewer firstaidkit-gui lshw-gui policycoreutils-gui sabayon setroubleshoot system-config-kickstart system-config-lvm wireshark-gnome
## Conditional Packages: system-config-services-docs system-config-users-docs

@graphical-admin-tools

## Attended Security Controls: 
-setroubleshoot             # CIS 1.4.4




### LEGACY-UNIX ###
## Group: Legacy UNIX compatibility
## Description: Compatibility programs for migration from or working with legacy UNIX environments.
## Default Packages: xinetd
## Optional Packages: authd cups-lpd dump finger finger-server krb5-appl-servers ksh mksh ncompress rsh rsh-server rusers rusers-server rwho talk talk-server tcp_wrappers telnet telnet-server tftp

## OTHERSSS REQUIREMENTS:
ksh

## Attended Security Controls: 
-telnet-server              # CIS 2.1.1
-telnet                     # CIS 2.1.2
-rsh-server                 # CIS 2.1.3
-rsh                        # CIS 2.1.4
-tftp                       # CIS 2.1.7
-talk-server                # CIS 2.1.10
-xinetd                     # CIS 2.1.11




### DIRECTORY-CLIENT ###
## Group: Directory Client
## Description: Clients for integration into a network managed by a directory service.
## Default Packages: ipa-client oddjob-mkhomedir sssd ypbind
## Optional Packages: certmonger hesinfo krb5-appl-clients krb5-pkinit-openssl krb5-workstation ldapjdk libsss_sudo nscd nss-pam-ldapd openldap-clients pam_krb5 pam_ldap samba-winbind sssd-dbus

@directory-client
krb5-workstation
pam_krb5
certmonger
samba-winbind
nscd
nss-pam-ldapd
openldap-clients
pam_ldap
sssd

## Attended Security Controls: 
-ypbind                     # CIS 2.1.5




### NETWORK-SERVER ###
## Group: Network Infrastructure Server
## Description: Servers for core network protocols and services, such as DHCP or DNS.
## Optional Packages: bind bind-chroot bind-dyndb-ldap dhcp dnsmasq freeradius quagga radvd rsyslog-gnutls rsyslog-gssapi rsyslog-mysql rsyslog-pgsql rsyslog-relp syslinux tftp-server

## Attended Security Controls: 
-tftp-server                # CIS 2.1.8
-dhcp                       # CIS 3.5




### MAIL-SERVER ###
## Group: E-mail server
## Description: Allows the system to act as a SMTP and/or IMAP e-mail server.
## Default Packages: dovecot postfix spamassassin
## Optional Packages: cyrus-imapd cyrus-imapd-perl dovecot-mysql dovecot-pgsql dovecot-pigeonhole mailman sendmail sendmail-cf

## Attended Security Controls: 
postfix                     # CIS 3.16




### SECURITY-TOOLS ###
## Group: Security Tools
## Description: Security tools for integrity and trust verification.
## Default Packages: scap-security-guide
## Optional Packages: aide amtu hmaccalc openscap openscap-utils p11-kit-trust scap-workbench tpm-tools trousers

## Attended Security Controls: 
aide                        # CIS 1.3.2




### X11 ###
## Group: X Window System
## Description: X Window System Support.
## Mandatory Packages: xorg-x11-drivers xorg-x11-server-Xorg xorg-x11-xauth xorg-x11-xinit
## Default Packages: firstboot glx-utils hal plymouth-system-theme spice-vdagent subscription-manager-firstboot wacomexpresskeys wdaemon xorg-x11-server-utils xorg-x11-utils xvattr
## Optional Packages: xcb-util-image xcb-util-keysyms xcb-util-wm

@x11

## NOT Implemented Security Controls: 
#-@"X Window System"         # CIS 3.2




### ADDITIONAL-DEVEL ###
## Group: Additional Development
## Description: Additional development headers and libraries for developing applications
## Default Packages: GConf2-devel alsa-lib-devel audit-libs-devel binutils-devel boost-devel bzip2-devel cyrus-sasl-devel dbus-glib-devel elfutils-devel elfutils-libelf-devel evolution-data-server-devel gnome-desktop-devel gnome-keyring-devel gstreamer-devel gvfs-devel hmaccalc java-1.6.0-openjdk-devel java-1.7.0-openjdk-devel libacl-devel libattr-devel libcanberra-devel libcap-ng-devel libcgroup-devel libcurl-devel libgnome-devel libnotify-devel librsvg2-devel libselinux-devel libsoup-devel mysql-devel perl-ExtUtils-MakeMaker perl-devel polkit-devel postgresql-devel pulseaudio-libs-devel pygtk2-devel python-devel readline-devel sqlite-devel tbb-devel
## Optional Packages: PyQt4-devel SDL-devel cups-devel e2fsprogs-devel expat-devel freeglut-devel fuse-devel gmp-devel gnome-python2-desktop gnutls-devel gstreamer-plugins-base-devel httpd-devel hunspell-devel iptables-devel java-1.8.0-openjdk-devel java-gcj-compat-devel junit kdebase-devel kdebase-workspace-devel kdegraphics-devel kdelibs-apidocs kdelibs-devel kdemultimedia-devel kdenetwork-devel kdepim-devel kdepimlibs-devel kdeplasma-addon-devel kdesdk-devel libXau-devel libXaw-devel libXinerama-devel libXmu-devel libXpm-devel libXrandr-devel libaio-devel libblkid-devel libbonobo-devel libcap-devel libdrm-devel libgcrypt-devel libglade2-devel libgnomeui-devel libgudev1-devel libhugetlbfs-devel libibverbs-devel libnl-devel libnl3-devel libtiff-devel libtopology-devel libudev-devel libusb-devel libuuid-devel libxslt-devel mpfr-devel net-snmp-devel numactl-devel openmotif-devel papi-devel pcre-devel perl-Test-More perl-Test-Pod perl-Test-Pod-Coverage popt-devel python-setuptools-devel sane-backends-devel snappy-devel startup-notification-devel tcl-devel tcp_wrappers-devel tk-devel unique-devel unixODBC-devel xorg-x11-proto-devel xz-devel

-@additional-devel


### COMPAT-LIBRARIES ###
## Group: Compatibility libraries
## Description: Compatibility libraries for applications built on previous versions of Red Hat Enterprise Linux.
## Default Packages: compat-db compat-expat1 compat-glibc compat-libcap1 compat-libf2c-34 compat-libgcc-296 compat-libgfortran-41 compat-libstdc++-295 compat-libstdc++-296 compat-libstdc++-33 compat-libtermcap compat-openldap compat-openmpi compat-openmpi-psm compat-opensm-libs compat-readline5 compat-xcb-util openssl098e

@compat-libraries
compat-openldap

## OTHERSSS REQUIREMENTS:
compat-readline5



### CONSOLE-INTERNET ###
## Group: Console internet tools
## Description: Console internet access tools, often used by administrators.
## Default Packages: elinks
## Optional Packages: fetchmail ftp irssi jwhois lftp mutt

@console-internet




### DEBUGGING ###
## Group: Debugging Tools
## Description: Tools for debugging misbehaving applications and diagnosing performance problems.
## Mandatory Packages: gdb kexec-tools latrace libreport-python strace systemtap-runtime
## Default Packages: abrt-addon-ccpp abrt-addon-python abrt-cli cas crash crash-gcore-command crash-trace-command elfutils ltrace trace-cmd valgrind
## Optional Packages: flightrecorder gdb-gdbserver glibc-utils lslk memtest86+ ps_mem systemtap-client systemtap-initscript

@debugging




### DESKTOP-DEBUGGING ###
## Group: Desktop Debugging and Performance Tools
## Description: GUI tools for debugging applications and performance.
## Default Packages: abrt-desktop libreport-gtk
## Optional Packages: abrt-gui bltk oprofile-gui pcp systemtap-grapher xrestop

@desktop-debugging
abrt-gui
pcp



### PERFORMANCE ###
## Group: Performance Tools
## Description: Tools for diagnosing system and application-level performance problems.
## Mandatory Packages: blktrace sysstat
## Default Packages: dstat iotop latencytop latencytop-tui oprofile perf powertop seekwatcher
## Optional Packages: oprofile-jit papi sdparm sg3_utils tuned tuned-utils

@performance
perf
tuned
tuned-utils




### BASIC-DESKTOP ###
## Group: Desktop
## Description: A minimal desktop that can also be used as a thin client.
## Mandatory Packages: NetworkManager NetworkManager-gnome alsa-plugins-pulseaudio at-spi control-center dbus gdm gdm-user-switch-applet gnome-panel gnome-power-manager gnome-screensaver gnome-session gnome-terminal gvfs-archive gvfs-fuse gvfs-smb metacity nautilus notification-daemon polkit-gnome xdg-user-dirs-gtk yelp
## Default Packages: control-center-extra eog gdm-plugin-fingerprint gnome-applets gnome-media gnome-packagekit gnome-vfs2-smb gok openssh-askpass orca pulseaudio-module-gconf pulseaudio-module-x11 rhn-setup-gnome subscription-manager-gui vino
## Optional Packages: sabayon-apply tigervnc-server xguest

@basic-desktop




### DESKTOP-PLATFORM ###
## Group: Desktop Platform
## Description: Supported libraries for the Red Hat Enterprise Linux Desktop Platform.
## Mandatory Packages: atk cairo dbus dbus-libs fontconfig freetype glib2 gtk2 libICE libSM libX11 libXext libXft libXi libXrender libXt libXtst libjpeg-turbo libpng libxml2 mesa-libGL mesa-libGLU pango qt qt3 redhat-lsb-graphics redhat-lsb-printing
## Optional Packages: qt-mysql qt-odbc qt-postgresql qt3-MySQL qt3-ODBC qt3-PostgreSQL

@desktop-platform

## OTHERSSS REQUIREMENTS:
mesa-libGL
mesa-libGLU
libpng




### FONTS ###
## Group: Fonts
## Description: Fonts for rendering text in a variety of languages and scripts.
## Default Packages: abyssinica-fonts cjkuni-uming-fonts dejavu-sans-fonts dejavu-sans-mono-fonts dejavu-serif-fonts google-crosextra-caladea-fonts google-crosextra-carlito-fonts jomolhari-fonts khmeros-base-fonts kurdit-unikurd-web-fonts liberation-mono-fonts liberation-sans-fonts liberation-serif-fonts lklug-fonts lohit-assamese-fonts lohit-bengali-fonts lohit-devanagari-fonts lohit-gujarati-fonts lohit-kannada-fonts lohit-oriya-fonts lohit-punjabi-fonts lohit-tamil-fonts lohit-telugu-fonts madan-fonts paktype-naqsh-fonts paktype-tehreer-fonts sil-padauk-fonts smc-meera-fonts stix-fonts thai-scalable-waree-fonts tibetan-machine-uni-fonts un-core-dotum-fonts vlgothic-fonts wqy-zenhei-fonts Optional Packages: bitmap-fixed-fonts bitmap-lucida-typewriter-fonts cjkuni-fonts-ghostscript

@fonts




### GENERAL-DESKTOP ###
## Group: General Purpose Desktop
## Description: A general purpose desktop that adds to Desktop and provides full GNOME features.
## Default Packages: PackageKit-gstreamer-plugin authconfig-gtk brasero-nautilus cheese compiz-gnome evince evince-dvi file-roller gcalctool gedit gnome-backgrounds gnome-bluetooth gnome-disk-utility gnome-power-manager gnome-system-monitor gnome-themes gnome-user-docs gnome-user-share gnome-utils gnote gthumb gucharmap gvfs-afc gvfs-gphoto2 gvfs-obexftp mousetweaks nautilus-open-terminal nautilus-sendto rhythmbox scenery-backgrounds seahorse sound-juicer system-config-firewall system-config-users totem totem-nautilus
## Optional Packages: alacarte byzanz dvgrab gconf-editor gedit-plugins gnome-games gnome-pilot gnome-pilot-conduits krb5-auth-dialog rhythmbox-upnp seahorse-plugins totem-upnp vim-X11

@general-desktop




### INTERNET-BROWSER ###
## Group: Internet Browser
## Description: Internet Browser
## Default Packages: firefox nspluginwrapper totem-mozplugin

@internet-browser




### CLIENT-MGMT-TOOLS ###
## Group: Client management tools
## Description: Tools and daemons for management of both bare metal hosts and virtualized guests.
## Optional Packages: vios-proxy

@client-mgmt-tools




### INPUT-METHODS ###
## Group: Input Methods
## Description: Software for the input of international text.
## Mandatory Packages: ibus-gtk
## Default Packages: ibus-anthy ibus-chewing ibus-hangul ibus-m17n ibus-pinyin ibus-rawcode ibus-sayura ibus-table-additional m17n-contrib-assamese m17n-contrib-bengali m17n-contrib-gujarati m17n-contrib-hindi m17n-contrib-kannada m17n-contrib-maithili m17n-contrib-malayalam m17n-contrib-marathi m17n-contrib-oriya m17n-contrib-punjabi m17n-contrib-tamil m17n-contrib-telugu m17n-contrib-urdu m17n-db-sinhala m17n-db-thai
## Conditional Packages: gtk2-immodule-xim ibus-qt

@input-methods




### SERVER-POLICY ###
## Group: Server Policy
## Description: Policy packages for the Server variant.
## Conditional Packages: gdm-policy-server

@server-policy




### SERVER-PLATFORM ###
## Group: Server Platform
## Description: Supported libraries for the Red Hat Enterprise Linux Server Platform.
## Mandatory Packages: db4 dbus-libs glibc krb5-libs libgcc libstdc++ ncurses-libs nss openldap openssl pam redhat-lsb zlib
## Optional Packages: libatomic libcilkrts libitm libmpx

@server-platform

## OTHERSSS REQUIREMENTS:
ncurses-libs



### SERVER-PLATFORM-DEVEL ###
## Group: Server Platform Development
## Description: Development headers and libraries for developing applications to run on the Red Hat Enterprise Linux Server Platform.
## Mandatory Packages: db4-devel dbus-devel glibc-devel krb5-devel libstdc++-devel libvirt-devel libvirt-java-devel ncurses-devel nss-devel openldap-devel openssl-devel pam-devel zlib-devel

## OTHERSSS REQUIREMENTS:
glibc-devel

## OTHERSSSSSSSSS REQUIREMENTS:
libstdc++.i686




### LEGACY-X ###
## Group: Legacy X Window System compatibility
## Description: Compatibility programs for migration from or working with legacy X Window System environments.
## Default Packages: xorg-x11-fonts-100dpi xorg-x11-fonts-ISO8859-1-100dpi xorg-x11-fonts-Type1 xorg-x11-fonts-misc
## Optional Packages: libXmu libXp openmotif openmotif22 xorg-x11-fonts-75dpi xorg-x11-fonts-ISO8859-1-75dpi xorg-x11-fonts-ISO8859-14-100dpi xorg-x11-fonts-ISO8859-14-75dpi xorg-x11-fonts-ISO8859-15-75dpi xorg-x11-fonts-ISO8859-2-100dpi xorg-x11-fonts-ISO8859-2-75dpi xorg-x11-fonts-ISO8859-9-100dpi xorg-x11-fonts-ISO8859-9-75dpi xorg-x11-fonts-cyrillic xorg-x11-fonts-ethiopic xorg-x11-twm xorg-x11-xdm xterm

@legacy-x
libXmu

## OTHERSSS REQUIREMENTS:
openmotif22




### NETWORK-FILE-SYSTEM-CLIENT ###
## Group: Network file system client
## Description: Enables the system to attach to network storage.
## Default Packages: autofs cifs-utils nfs-utils nfs4-acl-tools samba-client
## Optional Packages: cachefilesd glusterfs-fuse

@network-file-system-client




### JAVA-PLATFORM ###
## Group: Java Platform
## Description: Java support for the Red Hat Enterprise Linux Server and Desktop Platforms.
## Mandatory Packages: java-1.6.0-openjdk java-1.7.0-openjdk
## Optional Packages: icedtea-web java-1.8.0-openjdk

@java-platform
icedtea-web
java-1.8.0-openjdk




### PRINT-CLIENT ###
## Group: Printing client
## Description: Tools for printing to a local printer or a remote print server.
## Mandatory Packages: cups cups-pk-helper enscript printer-filters
## Default Packages: foomatic foomatic-db-ppds gutenprint gutenprint-cups hpijs paps system-config-printer system-config-printer-udev
## Optional Packages: hplip hplip-gui

@print-client
hplip




### REMOTE-DESKTOP-CLIENTS ###
## Group: Remote Desktop Clients
## Optional Packages: freerdp rdesktop spice-client spice-xpi tigervnc tsclient vinagre

@remote-desktop-clients




### PERL-RUNTIME ###
## Group: Perl Support
## Description: Perl interfaces to common libraries and functionality.
## Mandatory Packages: perl
## Default Packages: perl-Crypt-SSLeay perl-XML-Dumper perl-XML-Grove perl-XML-Twig perl-core
## Optional Packages: perl-DBD-SQLite perl-Date-Calc perl-Date-Manip perl-Frontier-RPC perl-LDAP perl-Mozilla-LDAP perl-suidperl

@perl-runtime
perl-DBD-SQLite




### DIRECTORY-SERVER ###
## Group: Directory Server
## Description: Machine and user identity servers.
## Optional Packages: krb5-server krb5-server-ldap migrationtools openldap-servers samba ypserv

## Attended Security Controls: 
-@directory-server
-ypserv                     # CIS 2.1.6




### KDE-DESKTOP ###
## Group: KDE Desktop
## Description: A KDE desktop.
## Mandatory Packages: alsa-plugins-pulseaudio kde-settings-pulseaudio kdeaccessibility kdeartwork-screensavers kdebase kdebase-workspace kdelibs xsettings-kde
## Default Packages: NetworkManager-gnome k3b kcoloredit kdeadmin kdegames kdegraphics kdemultimedia kdenetwork kdepim kdepim-runtime kdeplasma-addons kdeutils kdm kiconedit kipi-plugins kmid konq-plugins ksig ksshaskpass pinentry-qt rhn-setup-gnome subscription-manager-gui
## Optional Packages: kdebase-workspace-akonadi kdebase-workspace-python-applet
## Conditional Packages: ibus-qt

@kde-desktop
ibus-qt
-kdegames
-rhn-setup-gnome
-subscription-manager-gui
-k3b




### GRAPHICS ###
## Group: Graphics Creation Tools
## Description: Software for creation and manipulation of still images.
## Mandatory Packages: gimp
## Default Packages: gimp-data-extras gimp-help gimp-help-browser gutenprint-plugin libsane-hpaio sane-backends-libs-gphoto2 sane-frontends xsane xsane-gimp
## Optional Packages: ImageMagick dcraw inkscape netpbm-progs xfig

@graphics
ImageMagick
dcraw
inkscape
netpbm-progs
xfig




### OTHER PACKAGES SELECTIONS ###

mc
screen
sssd-ldap


## Attended Security Controls: 
-mcstrans                   # CIS 1.4.5

cronie-anacron              # CIS 6.1.1


## OTHERSSS Requirements:
elfutils-libelf

#libjpeg # Cant be installed due to libjpeg-turbo

gdbm

gdbm-devel

readline



## Other USER APPS:
libreoffice5.0*
libobasis5.0*





########################################################################################################################
# Post installation section

%post --log=/root/centos6.7-postinstall.log
#!/bin/bash


### +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ###
###                    SECURITY BENCHMARKS TUNNING                          ###
### +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ###


###############################################################################
### /etc/fstab                                                              ###
###############################################################################

echo -e "\n# CIS Benchmark Adjustments" >> /etc/fstab

# CIS 1.1.6
echo "/tmp /var/tmp none bind 0 0" >> /etc/fstab

# CIS 1.1.14-1.1.16
awk '$2~"^/dev/shm$"{$4="nodev,noexec,nosuid"}1' OFS="\t" /etc/fstab >> /tmp/fstab
mv /tmp/fstab /etc/fstab
restorecon -v /etc/fstab && chmod 644 /etc/fstab
###############################################################################




################################################################################
#### AIDE Cron Job                                                           ###
################################################################################
#
## CIS 1.3.2
#echo "0 5 * * * /usr/sbin/aide --check" >> /var/spool/cron/root
################################################################################




###############################################################################
### /etc/sysconfig/init                                                     ###
###############################################################################

# CIS 1.5.5
sed -i 's/^PROMPT=yes$/PROMPT=no/' /etc/sysconfig/init
###############################################################################




###############################################################################
### /etc/sysctl.conf                                                        ###
###############################################################################

cat << 'EOF' >> /etc/sysctl.conf

# CIS Benchmark Adjustments
kernel.exec-shield = 1 # CIS 1.6.2
kernel.randomize_va_space = 2 # CIS 1.6.3
net.ipv4.ip_forward = 0 # CIS 4.1.1
net.ipv4.conf.all.send_redirects = 0 # CIS 4.1.2
net.ipv4.conf.default.send_redirects = 0 # CIS 4.1.2
net.ipv4.conf.all.accept_source_route = 0 # CIS 4.2.1
net.ipv4.conf.default.accept_source_route = 0 # CIS 4.2.1
net.ipv4.conf.all.accept_redirects = 0 # CIS 4.2.2
net.ipv4.conf.default.accept_redirects = 0 # CIS 4.2.2
net.ipv4.conf.all.secure_redirects = 0 # CIS 4.2.3
net.ipv4.conf.default.secure_redirects = 0 # CIS 4.2.3
net.ipv4.conf.all.log_martians = 1 # CIS 4.2.4
net.ipv4.conf.default.log_martians = 1 # CIS 4.2.4
net.ipv4.icmp_echo_ignore_broadcasts = 1 # CIS 4.2.5
net.ipv4.icmp_ignore_bogus_error_responses = 1 # CIS 4.2.6
net.ipv4.conf.all.rp_filter = 1 # CIS 4.2.7
net.ipv4.conf.default.rp_filter = 1 # CIS 4.2.7
net.ipv4.tcp_syncookies = 1 # CIS 4.2.8
EOF
###############################################################################



###############################################################################
### /etc/audit/audit.rules                                                  ###
###############################################################################

cat << 'EOF' >> /etc/audit/audit.rules

# CIS Benchmark Adjustments

# CIS 5.2.4
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change
-a always,exit -F arch=b64 -S clock_settime -k time-change
-a always,exit -F arch=b32 -S clock_settime -k time-change
-w /etc/localtime -p wa -k time-change

# CIS 5.2.5
-w /etc/group -p wa -k identity
-w /etc/passwd -p wa -k identity
-w /etc/gshadow -p wa -k identity
-w /etc/shadow -p wa -k identity
-w /etc/security/opasswd -p wa -k identity

# CIS 5.2.6
-a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale
-a always,exit -F arch=b32 -S sethostname -S setdomainname -k system-locale
-w /etc/issue -p wa -k system-locale
-w /etc/issue.net -p wa -k system-locale
-w /etc/hosts -p wa -k system-locale
-w /etc/sysconfig/network -p wa -k system-locale

# CIS 5.2.7
-w /etc/selinux/ -p wa -k MAC-policy

# CIS 5.2.8
-w /var/log/faillog -p wa -k logins
-w /var/log/lastlog -p wa -k logins
-w /var/log/tallylog -p wa -k logins

# CIS 5.2.9
-w /var/run/utmp -p wa -k session
-w /var/log/wtmp -p wa -k session
-w /var/log/btmp -p wa -k session

# CIS 5.2.10
-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid>=500 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid>=500 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid>=500 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid>=500 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b64 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=500 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b32 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=500 -F auid!=4294967295 -k perm_mod

# CIS 5.2.11
-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid>=500 -F auid!=4294967295 -k access
-a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid>=500 -F auid!=4294967295 -k access
-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid>=500 -F auid!=4294967295 -k access
-a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid>=500 -F auid!=4294967295 -k access

# CIS 5.2.13
-a always,exit -F arch=b64 -S mount -F auid>=500 -F auid!=4294967295 -k mounts
-a always,exit -F arch=b32 -S mount -F auid>=500 -F auid!=4294967295 -k mounts

# CIS 5.2.14
-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid>=500 -F auid!=4294967295 -k delete
-a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid>=500 -F auid!=4294967295 -k delete

# CIS 5.2.15
-w /etc/sudoers -p wa -k scope

# CIS 5.2.16
-w /var/log/sudo.log -p wa -k actions

# CIS 5.2.17
-w /sbin/insmod -p x -k modules
-w /sbin/rmmod -p x -k modules
-w /sbin/modprobe -p x -k modules
-a always,exit -F arch=b64 -S init_module -S delete_module -k modules
-a always,exit -F arch=b32 -S init_module -S delete_module -k modules
EOF

# CIS 5.2.12
echo -e "\n# CIS 5.2.12" >> /etc/audit/audit.rules
find PART -xdev \( -perm -4000 -o -perm -2000 \) -type f | awk '{print "-a always,exit -F path=" $1 " -F perm=x -F auid>=500 -F auid!=4294967295 -k privileged" }' >> /etc/audit/audit.rules

# CIS 5.2.18
echo -e "\n# CIS 5.2.18" 
echo "-e 2" >> /etc/audit/audit.rules
###############################################################################




###############################################################################
### chkconfig                                                               ###
###############################################################################

# CIS 2.1.12
chkconfig chargen-dgram off
# CIS 2.1.13
chkconfig chargen-stream off
# CIS 2.1.14
chkconfig daytime-dgram off
# CIS 2.1.15
chkconfig daytime-stream off
# CIS 2.1.16
chkconfig echo-dgram off
# CIS 2.1.17
chkconfig echo-stream off
# CIS 2.1.18
chkconfig tcpmux-server off
# CIS 3.3
chkconfig avahi-daemon off
# CIS 3.4
chkconfig cups off
# CIS 3.6 (ntp.conf defaults meet requirements)
chkconfig ntpd on
# CIS 3.16 (postfix defaults meet requirements)
chkconfig sendmail off
alternatives --set mta /usr/sbin/sendmail.postfix
chkconfig postfix on
# CIS 5.1.3
chkconfig syslog off && chkconfig rsyslog on
# CIS 5.2.2
chkconfig auditd on
# CIS 6.1.2
chkconfig crond on
###############################################################################




###############################################################################
### umask                                                                   ###
###############################################################################
# CIS 3.1
echo "\n# CIS Benchmarks" 
echo "umask 027" >> /etc/sysconfig/init
###############################################################################




###############################################################################
### sshd                                                                    ###
###############################################################################

# CIS 6.2.4
sed -i 's/^#X11Forwarding no$/X11Forwarding no/' /etc/ssh/sshd_config
sed -i '/^X11Forwarding yes$/d' /etc/ssh/sshd_config
# CIS 6.2.5
sed -i 's/^.*MaxAuthTries.*$/MaxAuthTries 4/' /etc/ssh/sshd_config
# CIS 6.2.8
sed -i 's/^#PermitRootLogin.*$/PermitRootLogin no/' /etc/ssh/sshd_config
# CIS 6.2.11
echo -e "\n# CIS Benchmarks\n# CIS 6.2.12" >> /etc/ssh/sshd_config
echo "Ciphers aes128-ctr,aes192-ctr,aes256-ctr" >> /etc/ssh/sshd_config
# CIS 6.2.12
sed -i 's/^.*ClientAliveInterval.*$/ClientAliveInterval 300/' /etc/ssh/sshd_config
sed -i 's/^.*ClientAliveCountMax.*$/ClientAliveCountMax 0/' /etc/ssh/sshd_config
# CIS 6.2.14
echo "Unauthorized access is prohibited." > /etc/ssh/sshd_banner
echo -e "\n# CIS 6.2.14" >> /etc/ssh/sshd_config
echo "Banner /etc/ssh/sshd_banner" >> /etc/ssh/sshd_config
###############################################################################




###############################################################################
### Authentication                                                          ###
###############################################################################

# CIS 6.3.2
#sed -i 's/password.+requisite.+pam_cracklib.so/password required pam_cracklib.so try_first_pass retry=3 minlen=14,dcredit=-1,ucredit=-1,ocredit=-1 lcredit=-1/' /etc/pam.d/system-auth
# CIS 6.3.3
#sed -i -e '/pam_cracklib.so/{:a;n;/^$/!ba;i\password requisite pam_passwdqc.so min=disabled,disabled,16,12,8' -e '}' /etc/pam.d/system-auth
# CIS 6.3.6
#sed -i 's/^\(password.*sufficient.*pam_unix.so.*\)$/\1 remember=5/' /etc/pam.d/system-auth
# CIS 6.5
#sed -i 's/^#\(auth.*required.*pam_wheel.so.*\)$/\1/' /etc/pam.d/su

# CIS 7.1.1-7.1.3
#sed -i 's/^PASS_MAX_DAYS.*$/PASS_MAX_DAYS 90/' /etc/login.defs
#sed -i 's/^PASS_MIN_DAYS.*$/PASS_MIN_DAYS 7/' /etc/login.defs
#sed -i 's/^PASS_WARN_AGE.*$/PASS_WARN_AGE 7/' /etc/login.defs
###############################################################################




###############################################################################
### Login messages / message of the day                                     ###
###############################################################################

# CIS 8.1
echo "Authorized uses only. All activity may be monitored and reported." > /etc/motd
echo "Authorized uses only. All activity may be monitored and reported." > /etc/issue
echo "Authorized uses only. All activity may be monitored and reported." > /etc/issue.net
###############################################################################












###############################################################################
### Apps and User Space Configuration SETTINGS                              ###
###############################################################################

# Directory containing OS configuration files
CFG=http://<local_web_server>
# Directory containing package files
PKG=http://<local_web_server>
###############################################################################




###############################################################################
### REQUIRED dirs to mount NFS partitions                                   ###
###############################################################################

# Change to root installation directory
cd /
# Make required directories to mount network filesystems
mkdir dir1 dir2 dir3
###############################################################################




###############################################################################
### APPEND NFS to be mounted in /etc/fstab                                  ###
###############################################################################

## Append network filesystems to be mouted in /etc/fstab
wget -c $CFG/fstab -O /tmp/fstab --progress=bar -t inf --waitretry=3
cat /tmp/fstab >> /etc/fstab
###############################################################################




###############################################################################
### Sudoers File                                                            ###
###############################################################################

### Set sudores file
# Backup original sudoers file
cp  /etc/sudoers /etc/sudoers.orig
# Append sudo users list to in /etc/sudores
wget -c $CFG/sudoers -O /tmp/sudoers --progress=bar -t inf --waitretry=3
cat /tmp/sudoers >>/etc/sudoers
###############################################################################




###############################################################################
### NTP daemon Configuration                                                ###
###############################################################################

### Set time server daemon
# Backup original ntp.conf file
cp  /etc/ntp.conf /etc/ntp.conf.orig
rm /etc/ntp.conf
# Copy ntp configuration file to etc directory
wget -c $CFG/ntp.conf -O /etc/ntp.conf --progress=bar -t inf --waitretry=3
# Make ntp user the owner of /etc/ntp (required to create drift file)
chown -R ntp /etc/ntp
###############################################################################




###############################################################################
### Authentication and LDAP Settings                                        ###
###############################################################################

## Apply security controls
# CIS 6.3.2
sed -i 's/password.+requisite.+pam_cracklib.so/password required pam_cracklib.so try_first_pass retry=3 minlen=14,dcredit=-1,ucredit=-1,ocredit=-1 lcredit=-1/' /etc/pam.d/system-auth
# CIS 6.3.3
sed -i -e '/pam_cracklib.so/{:a;n;/^$/!ba;i\password requisite pam_passwdqc.so min=disabled,disabled,16,12,8' -e '}' /etc/pam.d/system-auth
# CIS 6.3.6
sed -i 's/^\(password.*sufficient.*pam_unix.so.*\)$/\1 remember=5/' /etc/pam.d/system-auth
# CIS 6.5
sed -i 's/^#\(auth.*required.*pam_wheel.so.*\)$/\1/' /etc/pam.d/su

# CIS 7.1.1-7.1.3
sed -i 's/^PASS_MAX_DAYS.*$/PASS_MAX_DAYS 90/' /etc/login.defs
sed -i 's/^PASS_MIN_DAYS.*$/PASS_MIN_DAYS 7/' /etc/login.defs
sed -i 's/^PASS_WARN_AGE.*$/PASS_WARN_AGE 7/' /etc/login.defs

###############################################################################




###############################################################################
### /etc/hosts                                                              ###
###############################################################################

### Add to /etc/hosts file critical host IPs
# Change to the workstation root installation directory
# Backup original hosts file
cp  /etc/hosts /etc/hosts.orig
# Append critial hosts to /etc/hosts
wget -c $CFG/hosts -O /tmp/hosts --progress=bar -t inf --waitretry=3
cat /tmp/hosts >> /etc/hosts
###############################################################################




###############################################################################
### Internal yum repository                                                 ###
###############################################################################

# Add internal yum repository
wget -c $CFG/centos.repo -O /etc/yum.repos.d/centos.repo --progress=bar -t inf --waitretry=3
###############################################################################




###############################################################################
### INSTALL and CONFIGURE PUPPET CLIENT                                     ###
###############################################################################

# Install puppet client
wget -c $PKG/Packages/augeas-libs-1.0.0-10.el6.x86_64.rpm -O /tmp/augeas-libs-1.0.0-10.el6.x86_64.rpm --progress=bar -t inf --waitretry=3
wget -c $PKG/Packages/ruby-libs-1.8.7.374-4.el6_6.x86_64.rpm -O /tmp/ruby-libs-1.8.7.374-4.el6_6.x86_64.rpm --progress=bar -t inf --waitretry=3
wget -c $PKG/Packages/ruby-1.8.7.374-4.el6_6.x86_64.rpm -O /tmp/ruby-1.8.7.374-4.el6_6.x86_64.rpm --progress=bar -t inf --waitretry=3
wget -c $PKG/Packages/libselinux-ruby-2.0.94-5.8.el6.x86_64.rpm -O /tmp/libselinux-ruby-2.0.94-5.8.el6.x86_64.rpm --progress=bar -t inf --waitretry=3
wget -c $PKG/Extras/puppet/facter-1.6.6-1.el5.x86_64.rpm -O /tmp/facter-1.6.6-1.el5.x86_64.rpm --progress=bar -t inf --waitretry=3
wget -c $PKG/Extras/puppet/ruby-augeas-0.4.1-1.el5.x86_64.rpm -O /tmp/ruby-augeas-0.4.1-1.el5.x86_64.rpm --progress=bar -t inf --waitretry=3
wget -c $PKG/Extras/puppet/ruby-shadow-1.4.1-7.el5.x86_64.rpm -O /tmp/ruby-shadow-1.4.1-7.el5.x86_64.rpm --progress=bar -t inf --waitretry=3
wget -c $PKG/Extras/puppet/puppet-2.6.14-1.el5.noarch.rpm -O /tmp/puppet-2.6.14-1.el5.noarch.rpm --progress=bar -t inf --waitretry=3
rpm -ivh /tmp/augeas-libs-1.0.0-10.el6.x86_64.rpm
rpm -ivh /tmp/ruby-libs-1.8.7.374-4.el6_6.x86_64.rpm
rpm -ivh /tmp/ruby-1.8.7.374-4.el6_6.x86_64.rpm
rpm -ivh /tmp/libselinux-ruby-2.0.94-5.8.el6.x86_64.rpm
rpm -ivh /tmp/facter-1.6.6-1.el5.x86_64.rpm 
rpm -ivh /tmp/ruby-augeas-0.4.1-1.el5.x86_64.rpm
rpm -ivh /tmp/ruby-shadow-1.4.1-7.el5.x86_64.rpm
rpm -ivh /tmp/puppet-2.6.14-1.el5.noarch.rpm

# Configure puppet client
wget -c $CFG/puppet.conf -O /etc/puppet/puppet.conf --progress=bar -t inf --waitretry=3

# Enable puppet service
chkconfig puppet on
###############################################################################




###############################################################################
### chkconfig                                                               ###
###############################################################################

# Disable autofs by default
chkconfig autofs off
###############################################################################




%end
